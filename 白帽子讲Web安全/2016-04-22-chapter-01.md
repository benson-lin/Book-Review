
## Web安全简史


- 早期，Web非互联网主流，黑客主要攻击的是网络、操作系统以及软件等领域；随着防火墙、ACL技术的发展，更加重视网络安全，改变了互联网安全走向，使直接暴露在互联网的系统得到了保护，暴露在互联网上的非Web服务越来越少。加上Web技术的成熟和功能强大，黑客目标转向Web
- Web1.0时代，更多关注服务器端动态脚本的安全问题，如上传一个可执行脚本到服务器，从而获得权限
- SQL注入的出现是Web安全史上的一个里程碑。通过SQL注入可以获取很多重要敏感的数据，效果不必直接攻击系统差
- XSS(Cross Site Scripting)跨站脚本攻击的出现是Web安全史上的另一个里程碑；实际上和SQL注入差不多
- Web2.0，XSS，CSRF变得强大，Web攻击的思路从服务器端转向客户端，转向浏览器和用户


## 黑帽子，白帽子

- 黑帽子：利用黑客技术造成破坏，甚至进行网络犯罪；
- 白帽子：精通安全技术，但是工作在反黑客领域的专家们
- 黑帽子只要找到系统的一个弱点就可达到入侵系统的目的；白帽子必须找到系统的所有缺点，不能遗漏。
- 白帽子一般为企业或安全公司服务，出发点是解决所有安全问题；黑帽子主要目的是入侵系统，找到有价值的数据，所以只需要以点突破，找到对他们有用的一点，在以此渗透，出发点必然是选择性和微观的
- 黑帽子为完成一次入侵，利用不同漏洞组合；白帽子则是不断分解问题，再对分解的问题逐个解决
- 定位的不对称导致白帽子安全工作比较难做

安全领域：“最大的漏洞就是人”。写得再好的程序，在有人参与的情况下，就可以出现不可预知的情况，如管理员密码泄露，程序员关掉了安全的配置参数。

## 安全的本质


如何产生的：划分不同信任级别的区域，称为**信任域**；划分两个不同信任域之间的边界，称为**信任边界**；数据从高等级的信任域流向低等级的信任域，是不需要经过安全检查的；数据从低等级信任域流向高等级信任域，则需要经过信任边界的安全检查

**安全问题的本质是信任问题**

一切安全方案设计的基础，都是建立在信任关系上。我们必须相信一些最基本的假设，安全方案才能建立


## 安全没有一劳永逸

安全是一个**持续**的过程

防御技术在发展同时，攻击技术也在不断发展。安全产品本身需要不断升级，也需要有人运营，否则会被淘汰。

现在安全，不代表以后是安全的。


## 安全三要素CIA

- **机密性**：保护数据不能泄露。加密。Confidentiality
- **完整性**：保护数据内容是完整的，没有被篡改的。数字签名。Integrity
- **可用性**：保护资源是“随需而得”。防止拒绝服务攻击DoS(Denial of Srevice)。Availability

还有可审计性，不可抵赖性等


## 实施安全评估

四个阶段：**资产等级划分、威胁分析、风险分析、确认解决方案**。层层递进，前后有因果关系

- 资产等级划分：帮助我们明确目标是什么，要保护什么；互联网安全的核心问题是数据安全问题，了解最重要的资产是什么，最看重的数据是什么，根据不同数据的重要程度，为后续安全评估指明方向；然后就可以划分信任域和信任边界，如把重要数据放入数据库，Web应用从数据库读取数据，对外提供服务，最外面是不可信任的Internet
- 威胁分析：对可能造成危害的来源称为威胁。有时需要经常回顾和更新现有模型
- 风险分析：把可能会出现的损失称为风险。风险的高低除了损失的大小外还需要考虑可能性。
- 设计安全方案：难在设计一个好解决方案，真正考验安全工程师的水平。没有不安全的业务，只有不安全的实现方式；好的安全方案对用户应该是透明的，尽可能不改变用户的使用习惯

一个优秀的安全方案的特点：能够有效解决问题，用户体验好，高性能，低耦合，易于扩展与升级

下面的原则是设计安全方案时可以使用的技巧。

## Serure By Defalut 原则

### 黑名单、白名单

应当只提供某些端口对外服务，而不是禁止某些端口开放，因为有些人会修改端口绕开安全策略；
白名单比黑名单安全，应该确认哪些可以通过，而不是哪些不允许通过，

如Web安全中，对提交的富文本进行XSS检查时，应当是只允许输入`<a>``<img>`等，而不是禁止`<script>``<iframe>`标签。如果以后出现新的攻击标签，黑名单就有问题

当然，白名单并不是一定就安全，因为安全也是建立在信任问题上，使用白名单设计安全方案，就说明白名单是好的，是安全的。如果名单中有不安全的，也就没有安全可言

### 最小权限原则

要求系统只授予主体必要的权限，而不是过度授权，能有效减少系统、网络、应用、数据库出错的机会

需要认真梳理业务需要的权限。很多时候，开发者不知道业务授予用户的权限过高。

## Defense in Depth 纵深防御原则

包含两层含义：首先，要在各个不同层面、不同方面实施安全方案，避免出现疏漏，不同安全方案之间要相互配合；其次，要在正确的地方做正确的事情，即在解决根本问题的地方实施针对性的安全方案

纵深防御不是同一个安全方案做两遍或多遍，避免木桶效应

## 数据与代码分离原则

这一原则广泛使用与各种由于“注入”而引发安全问题的场景

缓冲区溢出--程序在栈或堆中，将用户数据被当做代码执行，混淆了代码和数据的边界，违背开发者的本意

Web安全中，注入引起的问题：XSS,SQL Injection，CRLF Injection， X-Path Injection

## 不可预测原则

当无法做到系统中没有漏洞，可以采用让漏洞的攻击方法失效。

不可预测性能有效的对抗篡改、伪造的攻击，让攻击者无法猜测如何攻击

可以用在一些敏感数据上，如CSRF的防御技术上，通常会使用一个token来进行有效防御，因为攻击者在尝试攻击过程中，无法提前预知这个token的值；如用户id无法预测

不可预测性的实现往往需要用到加密算法，随机数算法，哈希算法

Secure By Default要时刻牢记；纵深防御要更全面更正确的看待问题；数据与代码分离，是从漏洞成因上看问题；不可预测性从克服攻击方法的角度上看问题